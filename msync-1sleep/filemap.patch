--- /usr/src/kernel-source-2.4.26/mm/filemap.c	2004-08-24 12:46:28.000000000 -0400
+++ filemap.c	2015-11-28 08:57:57.566734808 -0500
@@ -30,6 +30,10 @@
 
 #include <linux/highmem.h>
 
+/* sleep patch */
+#include <asm-i386/param.h>
+#include <linux/sched.h>
+
 /*
  * Shared mappings implemented 30.11.1994. It's not fully working yet,
  * though.
@@ -2353,6 +2357,8 @@
 		return -EBUSY;
 
 	if (file && (vma->vm_flags & VM_SHARED)) {
+		set_current_state(TASK_UNINTERRUPTIBLE);
+		schedule_timeout(2 * HZ);
 		ret = filemap_sync(vma, start, end-start, flags);
 
 		if (!ret && (flags & (MS_SYNC|MS_ASYNC))) {
